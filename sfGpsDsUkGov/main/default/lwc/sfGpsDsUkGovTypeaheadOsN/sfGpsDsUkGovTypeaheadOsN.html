<template>
  <div class={computedFormGroupClassName}>
    <div class="sfgpsds-label__group">
      <div class="sfgpsds-label__group_label_container">
        <div class="sfgpsds-label__group_label">
          <label
            class={computedLabelClassName}
            id="typeaheadLabelId"
            for="inputId"
          >
            {label}
          </label>
        </div>
      </div>

      <div class="sfgpsds-label__group_action">
        <slot name="iconRight"> </slot>
      </div>
    </div>

    <div if:true={fieldLevelHelp} id="helper" class="govuk-hint">
      {fieldLevelHelp}
    </div>

    <p
      if:true={isError}
      class="govuk-error-message"
      aria-live="assertive"
      role="alert"
      id="errorMessageBlock"
    >
      <span class="govuk-visually-hidden">{errorSrLabel}</span>
      {_errorMessage}
    </p>

    <div class="sfgpsds-form-element__control">
      <div class={showProgress}>
        <omnistudio-progress-bar
          if:true={remoteSource}
          data-progress-bar
          theme="slds"
          size="xx-small"
        >
        </omnistudio-progress-bar>
      </div>

      <div class="sfgpsds-combobox_container">
        <div
          class="sfgpsds-combobox sfgpsds-dropdown-trigger sfgpsds-dropdown-trigger_click"
        >
          <div class="sfgps-combobox__form-element" role="none">
            <input
              class={computedInputClassName}
              type={type}
              placeholder={placeholder}
              disabled={disabled}
              required={required}
              readonly={_readOnly}
              aria-readonly={_readOnly}
              tabindex={tabIndex}
              maxlength={maxLength}
              id="inputId"
              autocomplete="off"
              aria-activedescendant={activeDescendant}
              aria-autocomplete="list"
              aria-owns="listboxId"
              aria-haspopup="true"
              aria-expanded="false"
              aria-describedby={computedAriaDescribedBy}
              role="combobox"
              value={_value}
              onkeyup={searchOptions}
              oninput={updateValue}
              onfocus={focusChange}
              onblur={focusChange}
              onkeydown={handleKeydown}
            />
          </div>

          <div
            class="sfgpsds-dropdown sfgpsds-dropdown_fluid sfgpsds-dropdown_length-5"
            id="listboxId"
            role="listbox"
            onmousedown={handleScrollClick}
          >
            <ul
              class="sfgpsds-listbox sfgpsds-listbox_vertical"
              role="presentation"
            >
              <template
                for:each={sfGpsDsInternalData}
                for:item="item"
                for:index="index"
              >
                <li
                  key={item.itrKey}
                  style={styleProperties.value.styles}
                  class="sfgpsds-listbox__item"
                  role="presentation"
                  data-itrkey={item.itrKey}
                >
                  <div
                    class={item.itemClass}
                    aria-selected={item.selected}
                    id={item.itrKey}
                    role="option"
                    data-index={indext}
                    onclick={selectOption}
                  >
                    <span class="sfgpsds-media__body">
                      <span class="sfgpsds-listbox__option-text"
                        >{item.name}</span
                      >
                    </span>
                  </div>
                </li>
              </template>

              <li
                class="sfgpsds-listbox__item"
                style={styleProperties.value.styles}
              >
                <div
                  class={_sfGpsDsLastItemClass}
                  role="option"
                  data-index="last-item"
                  onclick={selectOption}
                >
                  <span class="sfgpsds-media__body">
                    <span class="sfgpsds-listbox__option-text">
                      <slot name="lastItem" onslotchange={lastItemChange}>
                      </slot>
                    </span>
                  </span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
