<template>
  <div class={computedFormGroupClassName}>
    <h3 class="govuk-label-wrapper">
      <label
        class={computedLabelClassName}
        aria-label={mergedLabel}
        for="inputId"
      >
        {mergedLabel}
      </label>
    </h3>

    <div if:true={mergedHelpText} id="helper" class="govuk-hint">
      {mergedHelpText}
    </div>

    <p
      if:true={isError}
      class="govuk-error-message"
      aria-live="assertive"
      role="alert"
      id="errorMessageBlock"
    >
      <span class="govuk-visually-hidden">{errorSrLabel}</span>
      {_errorMessage}
    </p>

    <template if:true={_propSetMap.repeat}>
      <span
        slot="label"
        style="bottom: 7px; right: -11px"
        class={_styleClasses.repeatContainer}
        role="group"
      >
        <button
          if:true={canRepeat}
          class={_styleClasses.repeatAdd}
          onclick={handleAdd}
        >
          <omnistudio-icon
            icon-name="utility:add"
            alternative-text={_repeatAlternativeText}
            extraclass={_styleClasses.repeatIcons}
            size="xx-small"
          >
          </omnistudio-icon>
        </button>
        <button
          if:true={canRemove}
          class={_styleClasses.repeatRemove}
          onclick={handleRemove}
        >
          <omnistudio-icon
            icon-name="utility:close"
            alternative-text={_removeAlternativeText}
            extraclass={_styleClasses.repeatIcons}
            size="xx-small"
          >
          </omnistudio-icon>
        </button>
      </span>
    </template>

    <div class="sfgpsds-form-element__control">
      <div class="sfgpsds-combobox_container">
        <div
          class="sfgpsds-combobox sfgpsds-dropdown-trigger sfgpsds-dropdown-trigger_click slds-dropdown-trigger slds-dropdown-trigger_click"
        >
          <div class="sfgps-combobox__form-element" role="none">
            <input
              class={computedInputClassName}
              type="text"
              value={lookupDisplay}
              disabled={_propSetMap.readOnly}
              required={_propSetMap.required}
              readonly={_propSetMap.readOnly}
              aria-controls="lookup"
              id="lookupId"
              placeholder={_propSetMap.placeholder}
              aria-invalid={isAriaInvalid}
              aria-describedby={computedAriaDescribedBy}
              data-omni-input
              onblur={hideOptions}
              onkeydown={handleKeyDown}
              onkeyup={handleKeyUp}
              onmouseup={showLookup}
              role="combobox"
              aria-expanded={show}
              aria-haspopup="listbox"
              aria-autocomplete="list"
            />
          </div>
          <div
            class="sfgpsds-dropdown sfgpsds-dropdown_length-5 sfgpsds-dropdown_fluid"
            id="lookup"
            role="listbox"
            onmousedown={handleKeyDown}
            onmouseleave={handleKeyDown}
            onmouseup={handleKeyDown}
          >
            <ul
              class="sfgpsds-listbox sfgpsds-listbox_vertical"
              role="presentation"
            >
              <template
                for:each={computedOptions}
                for:item="optionItem"
                for:index="optionIndex"
              >
                <!-- removed onmouseover=mouseOverFocus-->
                <li
                  key={optionItem.key}
                  class="sfgpsds-listbox__item"
                  role="presentation"
                  onmouseup={selectOption}
                >
                  <div
                    class="sfgpsds-listbox__option sfgpsds-listbox__option_has-meta"
                    id={optionItem.id}
                    role="option"
                    data-option-index={optionIndex}
                    aria-selected={optionItem.selected}
                  >
                    <span
                      class="sfgpsds-media__body"
                      data-option-index={optionIndex}
                    >
                      <span
                        class="sfgpsds-listbox__option-text"
                        data-option-index={optionIndex}
                      >
                        {optionItem.value}
                      </span>
                    </span>
                  </div>
                </li>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <template if:true={isPageLoading}>
      <omnistudio-spinner
        variant="brand"
        alternative-text={allCustomLabelsUtil.OmniSpinnerTextLoading}
        size="small"
      >
      </omnistudio-spinner>
    </template>
  </div>
</template>
