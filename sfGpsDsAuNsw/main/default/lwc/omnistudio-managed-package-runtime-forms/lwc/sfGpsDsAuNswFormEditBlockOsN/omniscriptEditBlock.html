<!-- sldsValidatorIgnore -->
<template>
  <div class="nsw-grid">
    <!-- Removing the default base element's bottom margin of x-small (slds only)-->

    <div class="nsw-col nsw-table sfgpsds-nsw-edit-block__nextindex">
      <table>
        <!-- Table Header -->
        <thead lwc:if={_isFirstIndex}>
          <tr>
            <th>
              <span class="sr-only">Error</span>
            </th>
            <template
              for:each={_tableLabels}
              for:item="dvItem"
              for:index="dvIndex"
            >
              <th
                key={dvItem.lwcId}
                class={dvItem.cls}
                width={dvItem.tableWidth}
              >
                {dvItem.label}
              </th>
            </template>
          </tr>
        </thead>

        <!-- Table is always visible -->
        <template lwc:if={_hasChildren}>
          <tbody
            if:false={_isEditing}
            aria-describedby={computedErrorTextId}
            aria-invalid={isInvalid}
            class="omni-editblock-table-row"
          >
            <tr>
              <td>
                <template lwc:if={isInvalid}>
                  <span class="sr-only" id="table-text-error">
                    {allCustomLabelsUtil.OmniEditBlockRowError}
                  </span>
                  <span
                    aria-hidden="true"
                    class="nsw-form__required"
                    title={requiredLabel}
                  >
                  </span>
                  <span class="sr-only"> ({requiredLabel})</span>
                </template>
              </td>

              <template
                for:each={_displayValues}
                for:item="dvItem"
                for:index="dvIndex"
              >
                <td
                  key={dvItem.lwcId}
                  class={dvItem.cls}
                  width={dvItem.tableWidth}
                >
                  <!-- Checkbox for FS / Table -->
                  <template lwc:if={dvItem.isCheckbox}>
                    <div>
                      <input
                        id={dvItem.checkboxId}
                        type="checkbox"
                        checked={dvItem.value}
                        onclick={handleCheckbox}
                        onkeydown={handleKeyboardCheckbox}
                        data-is-selected={_showCheckbox}
                        class="nsw-form__checkbox-input"
                      />
                      <label
                        for={dvItem.checkboxId}
                        class="nsw-form__checkbox-label"
                      >
                        <span lwc:if={dvItem.value} class="sr-only"
                          >Selected</span
                        >
                        <span lwc:else class="sr-only">Unselected</span>
                      </label>
                    </div>
                  </template>
                  <!-- Text -->
                  <template lwc:else> {dvItem.value} </template>
                </td>
              </template>
              <!-- </div> -->

              <td>
                <!-- Menu Action Icon -->
                <c-sf-gps-ds-au-nsw-button-menu-os
                  lwc:if={_useActionMenu}
                  id="actionmenu"
                  lwc:ref="actionmenu"
                  items={decoratedActionMenuItems}
                  variant="unpadded"
                  prevent-default="true"
                  onitemselected={handleActionMenuSelected}
                >
                </c-sf-gps-ds-au-nsw-button-menu-os>
              </td>
            </tr>
          </tbody>
        </template>
      </table>
    </div>

    <!-- Modal Editing -->
    <c-sf-gps-ds-au-nsw-dialog-os
      title={_propSetMap.label}
      bstyle="dark"
      is-dismissible="true"
      is-open={_isEditing}
      primary-button-text={allCustomLabelsUtil.OmniConfigProdModalOk}
      secondary-button-text={allCustomLabelsUtil.OmnicancelLabel}
      class-name={className}
      onprimaryclick={save}
      onsecondaryclick={cancel}
      onclose={cancel}
    >
      <!-- disabled={isPageLoading} -->
      <slot class="nsw-grid nsw-p-left-sm"> </slot>
    </c-sf-gps-ds-au-nsw-dialog-os>

    <!-- Add Button -->
    <div lwc:if={showAdd} class="nsw-col">
      <button
        type="button"
        class="nsw-button nsw-button--dark-outline editblock-new"
        onclick={handleAdd}
      >
        {_newLabel}
      </button>
    </div>
  </div>

  <!-- Spinner -->
  <c-sf-gps-ds-au-nsw-loader-os
    lwc:if={isPageLoading}
    label={allCustomLabelsUtil.OmniSpinnerTextLoading}
    size="md"
  >
  </c-sf-gps-ds-au-nsw-loader-os>
</template>
