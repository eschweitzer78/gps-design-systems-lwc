<!-- sldsValidatorIgnore -->
<template>
  <div style="margin-top: -0.25rem">
    <!-- Removing the default base element's bottom margin of x-small (slds only)-->

    <template lwc:if={_isFirstIndex}>
      <!-- Header/Label -->
      <div>
        <label class="nsw-form__label" for="form-edit-block-table">
          {_propSetMap.label}
        </label>
      </div>

      <!-- Global Actions -->
      <div lwc:if={_propSetMap.gActions} class="nsw-list nsw-list--8">
        <template
          for:each={_gActions}
          for:item="gActionItem"
          for:index="gActionIndex"
        >
          <c-sf-gps-ds-osrt-icon
            lwc:if={gActionItem.hasIcon}
            key={gActionItem.lwcId}
            extraclass="slds-input__icon"
            icon-name={gActionItem.icon}
            theme="slds"
            alternative-text={gActionItem.label}
            size="small"
            style="cursor: pointer"
            onclick={gActionItem.handleClick}
          >
          </c-sf-gps-ds-osrt-icon>
          <button
            lwc:else
            key={gActionItem.lwcId}
            class="nsw-button nsw-button--dark-outline"
            onclick={gActionItem.handleClick}
          >
            {gActionItem.label}
          </button>
        </template>
      </div>
    </template>

    <div id="form-edit-block-table" class="nsw-table">
      <table>
        <!-- Table Header -->
        <thead if:true={_isFirstIndex}>
          <tr>
            <th>
              <span class="sr-only">Error</span>
            </th>
            <template
              for:each={_tableLabels}
              for:item="dvItem"
              for:index="dvIndex"
            >
              <th
                key={dvItem.lwcId}
                class={dvItem.cls}
                width={dvItem.tableWidth}
              >
                {dvItem.label}
              </th>
            </template>
          </tr>
        </thead>

        <!-- Table is always visible -->
        <template if:true={_hasChildren}>
          <tbody
            if:false={_isEditing}
            onclick={handleCheckbox}
            data-is-selected={_showCheckbox}
            tabindex="0"
            aria-describedby="table-text-error"
            aria-invalid={isInvalid}
            role="rowgroup"
          >
            <tr>
              <td>
                <template lwc:if={isInvalid}>
                  <span class="sr-only" id="table-text-error">
                    {allCustomLabelsUtil.OmniEditBlockRowError}
                  </span>
                  <span
                    aria-hidden="true"
                    class="nsw-form__required"
                    title={requiredLabel}
                  >
                  </span>
                  <span class="sr-only"> ({requiredLabel})</span>
                </template>
              </td>

              <template
                for:each={_displayValues}
                for:item="dvItem"
                for:index="dvIndex"
              >
                <td
                  key={dvItem.lwcId}
                  class={dvItem.cls}
                  width={dvItem.tableWidth}
                >
                  <!-- Checkbox for FS / Table -->
                  <template lwc:if={dvItem.isCheckbox}>
                    <div>
                      <input
                        id={dvItem.checkboxId}
                        type="checkbox"
                        checked={dvItem.value}
                        class="nsw-form__checkbox-input"
                      />
                      <label
                        for={dvItem.checkboxId}
                        class="nsw-form__checkbox-label sr-only"
                      >
                        Select
                      </label>
                    </div>
                  </template>
                  <!-- Text -->
                  <template lwc:else> {dvItem.value} </template>
                </td>
              </template>
              <!-- </div> -->

              <td>
                <!-- Menu Action Icon -->
                <c-sf-gps-ds-au-nsw-button-menu
                  if:true={_useActionMenu}
                  id="action-menu"
                  lwc:ref="action-menu"
                  items={decoratedActionMenuItems}
                  variant="unpadded"
                  prevent-default="true"
                  onitemselected={handleActionMenuSelected}
                  onclick={test}
                >
                </c-sf-gps-ds-au-nsw-button-menu>
              </td>
            </tr>
          </tbody>
        </template>
      </table>
    </div>

    <!-- Modal Editing -->
    <c-sf-gps-ds-au-nsw-dialog
      title={_propSetMap.label}
      bstyle="dark"
      is-dismissible="true"
      is-open={_isEditing}
      primary-button-text={allCustomLabelsUtil.OmniConfigProdModalOk}
      secondary-button-text={allCustomLabelsUtil.OmnicancelLabel}
      class-name={className}
      onprimaryclick={save}
      onsecondaryclick={cancel}
      onclose={cancel}
    >
      <!-- disabled={isPageLoading} -->
      <slot class="nsw-grid nsw-p-left-sm"> </slot>
    </c-sf-gps-ds-au-nsw-dialog>

    <!-- Add Button -->
    <div
      if:true={showAdd}
      class="nsw-display-flex nsw-justify-content-end nsw-m-top-sm"
    >
      <button
        type="button"
        class="nsw-button nsw-button--dark-outline editblock-new"
        onclick={handleAdd}
      >
        {_newLabel}
      </button>
    </div>
  </div>

  <!-- Spinner -->
  <template lwc:if={isPageLoading}>
    <c-sf-gps-ds-au-nsw-loader
      label={allCustomLabelsUtil.OmniSpinnerTextLoading}
      size="md"
    >
    </c-sf-gps-ds-au-nsw-loader>
  </template>
</template>
