<template>
  <p>required: {_required}</p>
  <div class="slds-form-element">
    <div class={errorClass}>
      <div class="slds-grid" data-label="true">
        <label
          if:false={isLabelHidden}
          class={extraLabelClasses}
          for="combobox"
          id="combobox-label"
          style="width: auto"
        >
          <abbr lwc:if={_required} title={_requiredLabel} class="slds-required"
            >*</abbr
          >
          <span>{label}</span>
        </label>

        <div data-field-level-help>{fieldLevelHelp}</div>
        <slot name="label"></slot>
      </div>

      <div class="slds-form-element__control">
        <div class="slds-combobox_container">
          <div
            class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
            role="none"
          >
            <input
              id="combobox"
              type={type}
              value={_displayValue}
              data-value={_valueMap}
              disabled={_disabled}
              required={_required}
              readonly={isNotInput}
              placeholder={placeholder}
              tabindex={tabIndex}
              autocomplete="off"
              aria-describedby="errorMessageBlock"
              aria-expanded={_isOpen}
              aria-haspopup="listbox"
              aria-controls="combobox-list"
              aria-activedescendant={_activeDescendant}
              aria-invalid={_isError}
              role="combobox"
              class="slds-input slds-listbox__option-text_entity"
              onblur={showLookup}
              onmouseup={showLookup}
              onkeydown={preventKeyDown}
              onkeyup={handleKeyUp}
            />
            <span
              class="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right"
              aria-hidden="true"
            >
              <!-- arrow down icon -->
            </span>
          </div>
        </div>

        <div class="slds-form-element">
          <div
            id="combobox-list"
            role="listbox"
            aria-labelledby="combobox-label"
            class="slds-dropdown slds-dropdown_fluid slds-p-bottom_none slds-dropdown_left"
            onmousedown={preventLookupClose}
            onmouseleave={preventLookupOpen}
            onmouseup={preventLookupOpen}
          >
            <ul
              class="dropdown-container listbox slds-listbox slds-listbox_vertical"
              role="presentation"
              style={dropdownStyle}
            >
              <template for:each={_displayOptions} for:item="item">
                <li
                  lwc:if={item.isGrouped}
                  key={item.optId}
                  class="slds-listbox__item"
                >
                  <div
                    class="slds-listbox__option slds-listbox__option_plain slds-media slds-media_small"
                    role="option"
                  >
                    <h3 class="slds-text-title_caps">{item.group}</h3>
                  </div>
                </li>
                <li key={item.optId} class="slds-listbox__item">
                  <div
                    id={item.optId}
                    data-value={item.value}
                    data-label={item.label}
                    data-option-id={item.optId}
                    role="option"
                    class="slds-listbox__option slds-listbox__option_plain slds-media slds-media_small"
                    onmouseup={selectOption}
                    onmouseover={handleMouseOver}
                    onmouseout={handleMouseOut}
                  >
                    <span class="slds-media__body">
                      <span
                        class="slds-listbox__option-text slds-listbox__option-text_entity"
                        >{item.label} - {item.optId}</span
                      >
                    </span>
                  </div>
                </li>
              </template>
            </ul>

            <footer
              if:false={_hideFooter}
              class={footerClass}
              onmousedown={preventTrigger}
            >
              <slot name="footer"></slot>
            </footer>
          </div>
        </div>

        <div
          lwc:if={_isError}
          id="errorMessageBlock"
          role="alert"
          class="slds-form-element__help"
        >
          {_errorMessage}
        </div>
      </div>

      <template lwc:if={multiple}>
        <div lwc:if={_inputLabels} class="slds-listbox_selection-group">
          <ul
            class={pillWrapperClass}
            role="listbox"
            aria-label={i18n.selectedOptionsLabel}
            aria-orientation="horizontal"
          >
            <template for:each={_inputLabels} for:item="item">
              <li key={item} class="slds-listbox-item" role="presentation">
                <span
                  class="slds-pill"
                  role="option"
                  tabindex="0"
                  aria-selected="true"
                >
                  <span class="slds-pill__label" title={item}>{item}</span>
                  <template lwc:if={showDelIcon}>
                    <div data-label={item} onclick={deleteThisLabel}>X</div>
                  </template>
                </span>
              </li>
            </template>
          </ul>
        </div>
      </template>
    </div>
  </div>
</template>
