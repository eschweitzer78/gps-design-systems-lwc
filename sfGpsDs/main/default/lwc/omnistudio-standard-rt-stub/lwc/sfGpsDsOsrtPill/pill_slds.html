<!-- sldsValidatorIgnore -->
<template>
  <div class={pillClass}>
    <div
      class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
      role="none"
    >
      <template if:true={label}>
        <label
          id="pill-label"
          class="slds-form-element__label slds-show"
          for="pill-1"
        >
          <abbr if:true={required} class="slds-required" title="required"
            >*</abbr
          >
          <span style={styleProperties.label.styles}>{label}</span>
        </label>
      </template>
      <div class="slds-form-element__control">
        <div class="slds-combobox_container" if:false={viewonly}>
          <div
            class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-is-open"
            aria-expanded="false"
            aria-haspopup="listbox"
            role="combobox"
          >
            <div
              class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
              role="none"
            >
              <input
                id="pill-1"
                type="typeahead"
                name={name}
                class="slds-input slds-combobox__input"
                value={inputValue}
                data-value={pillValue}
                aria-autocomplete="list"
                aria-controls="pilllist"
                autocomplete="off"
                role="combobox"
                placeholder={placeholder}
                disabled={disabled}
                oninput={filterOptions}
                onblur={toggleLookup}
                onfocus={toggleLookup}
                onkeydown={handleKeyDown}
              />
            </div>
            <div
              if:true={islistvisible}
              class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid"
              aria-labelledby="pill-label"
              role="listbox"
            >
              <ul
                class="slds-listbox slds-listbox_vertical"
                role="presentation"
              >
                <template
                  for:each={filteredOptions}
                  for:item="item"
                  for:index="index"
                >
                  <li key={item.id} class={item.class} role="presentation">
                    <div
                      class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
                      data-field={item.label}
                      onmousedown={selectOption}
                      role="option"
                      tabindex="0"
                      aria-label={item.label}
                    >
                      <span class="slds-media__body">
                        <span
                          class="slds-listbox__option-text slds-listbox__option-text_entity"
                          >{item.label}</span
                        >
                      </span>
                    </div>
                  </li>
                </template>
              </ul>
            </div>
          </div>
        </div>
        <div class={itemTagClass} role="listbox" aria-labelledby="pill-label">
          <template for:each={valueMap} for:item="item" for:index="index">
            <span
              key={item.id}
              class="slds-pill slds-p-horizontal_x-small"
              role="option"
              tabindex="0"
              aria-selected="true"
              aria-label={item.label}
              style={styleProperties.value.styles}
            >
              <span class="slds-pill__label">{item.label}</span>
              <c-sf-gps-ds-osrt-button
                theme="slds"
                icon-only
                class="slds-icon_container slds-pill__remove"
                if:false={viewonly}
                title={translatedLabels.cmpRemove}
                data-field={item.label}
                tabindex="0"
                icon-name="utility:close"
                icon-size="x-small"
                icon-parent-type="default"
                icon-variant="default"
                icon-url={iconUrl}
                aria-label={translatedLabels.cmpRemove}
                onclick={removeValue}
              ></c-sf-gps-ds-osrt-button>
            </span>
          </template>
        </div>
      </div>
    </div>
  </div>
</template>
